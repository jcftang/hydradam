<?xml version="1.0" encoding="UTF-8"?>
<blueprint
    xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
      http://www.osgi.org/xmlns/blueprint/v1.0.0
      http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd">

    <camelContext xmlns="http://camel.apache.org/schema/blueprint" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:access="http://www.fedora.info/definitions/1/0/access/">

      <route>
        <from uri="direct:create_object_from_file" />
        <setHeader headerName="repository_url">
          <constant>http://localhost:8983/fedora</constant>
        </setHeader>
        <setHeader headerName="pid">
          <constant>new</constant>
        </setHeader>

        <setHeader headerName="file_content">
          <simple>${body}</simple>
        </setHeader>
        <inOut uri="vm:fedora.create_object" />

        <setHeader headerName="pid">
          <simple>${body}</simple>
        </setHeader>
        <transform>
          <simple>${header.file_content}</simple>
        </transform>


        <removeHeaders pattern="CamelHttp*" />

        <setHeader headerName="dsid">
          <constant>content</constant>
        </setHeader>
        <setHeader headerName="mimeType">
          <constant>application/octet-stream</constant>
        </setHeader>
        <to uri="vm:fedora.datastream.create" />
      </route>

      <route>
        <from uri="file:ingest_watch_folder" />
        <to uri="direct:create_object_from_file" />
      </route>

    </camelContext>
  </blueprint>
